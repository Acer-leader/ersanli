<include file="Public:head"/>
<style>
.imgnav {
    max-height: 30px;
    overflow: hidden;
    cursor: pointer;
}
.imgwrapper {
    display: block;
    width: 78px;
    height: 78px;
    overflow: hidden;
}
.imgwrapper img {
    display: block;
    width: 100%;
    padding: 0;
    margin: 0;
    border: 0;
}
.spanpd10 {
    margin: 10px;
}
.wxtables.wxtables-sku.newtable {
    width: 40%;
    margin: 0;
}
.img-list li {
    width: 60px;
    height: 60px;
}
.cst_h3 span {
    font-weight: normal;
}
#imgdiv img {
    max-width: 190px;
    max-height: 190px;
    display: none;
    margin: 5px;
}
.btnimage {
    width: 80px;
    height: 30px;
    background: white;
    border: 1px solid #d9d9d9;
    cursor: pointer;
    position: relative;
    text-align: center;
    line-height: 31px;
}
.file {
    position: absolute;
    top: 0px;
    left: 0;
    width: 80px;
    height: 30px;
    background: white;
    border: 1px solid #d9d9d9;
    cursor: pointer;
    opacity: 0
}
#imgdiv2 img {
    max-width: 88px;
    max-height: 88px;
    display: none;
    margin: 5px;
}
#xuanze2 {
    width: 60px;
    height: 30px;
    background: white;
    border: 1px solid #d9d9d9;
}
#xuanze2:hover {
    background: #E6E6E6;
}
.huase {
    display: none;
    width: 86px;
    height: 30px;
    margin: 5px;
    text-indent: 5px;
}
</style>
<div class="container">
  <div class="inner clearfix"> <include file="Public:left"/> 
    <!-- end content-left -->
    
    <div class="content-right fl">
      <h1 class="content-right-title">发布商品</h1>
        <form aciton="{:U('/Admin/Pointsmall/addgoods')}" enctype="multipart/form-data" method="post" id="add_step2" onsubmit="return toVaild()">
        <input type="hidden" value="{$info.id|default=0}" name="id">
        <input type="hidden" value="{$storeid}" name="storeid">
        <!-- end 基本信息 -->
        <div class="panel-single panel-single-light mgt20">
        <h3 class="cst_h3 mgb20">商品信息</h3>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed">*</span>选择商城：</label>
          <div class="form-controls">
            <div class="radio-group">
              <foreach name="malllist" item="vo" >
                <if condition="$vo['is'] eq 1 ">
                  <label><input type="checkbox" name="malltype[]" value="{$vo.id}" checked="checked" class="shangcheng">{$vo.classname}</label>
                  <else /> 
                  <label><input type="checkbox" name="malltype[]" value="{$vo.id}" class="shangcheng">{$vo.classname}</label>
                </if>
              </foreach>
            </div>
          </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed">*</span>产品分类：</label>
          <div class="form-controls">
            <a href="javascript:void(0)" class="btn btn-primary" id="j-select_category_id"> <i class="gicon-edit white"></i> 选择产品分类 </a>
            <input type="text" value="{$info.catetitle}" id="class_name" style="border: 1px solid #fff;width: 500px;background-color:#fff;" disabled="">
            <input type="hidden" value="{$info.cateid}" name="cateid" id="class_id">
            <span class="fi-help-text error"></span> </div>
        </div>
        <div class="formitems splikemall" style="display:none">
          <label class="fi-name"><span class="colorRed">*</span>秒杀时间点：</label>
          <div class="form-controls">
            <a href="javascript:void(0)" class="btn btn-primary" id="j-selecttimelimitid"> <i class="gicon-edit white"></i> 选择秒杀时间点 </a>
            <input type="text" value="{$info.timelimittitle}" id="timelimittitle" class="input" style="border: 1px solid #fff;background-color:#fff;">
            <input type="hidden" value="{$info.timelimitid}" name="timelimitid">
            <span class="fi-help-text error"></span> </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed">*</span>产品名称：</label>
          <div class="form-controls">
            <input type="text" class="input xxlarge" name="title" value="{$info.title}" placeholder="产品名字">
            <span class="fi-help-text"></span> </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed">*</span>产品简介：</label>
          <div class="form-controls">
            <input type="text" class="input xxlarge" name="description" value="{$info.description}" placeholder="简短介绍 20字内">
            <span class="fi-help-text"></span> </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed">*</span>产品短标题：</label>
          <div class="form-controls">
            <input type="text" class="input xxlarge" name="slug" value="{$info.slug}" placeholder="短标题">
            <span class="fi-help-text"></span> </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed">*</span>产品副标题：</label>
          <div class="form-controls">
            <input type="text" class="input xxlarge" name="subtitle" value="{$info.subtitle}" placeholder="产品副标题">
            <span class="fi-help-text"></span> </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>供应商：</label>
          <div class="form-controls">
            <input type="text" class="input xxlarge" name="supplier" value="{$info.supplier}" placeholder="产品副标题">
            <span class="fi-help-text"></span> </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed">*</span>商品logo图片：</label>
          <div class="form-controls pdt5 j-imglistPanel">
            <div class="xuanze_showimge fl mgr10"><notempty name="info.logo"><img src="{$info.logo}" height="80"></notempty></div>
            <div class="btnimage fl">选择图片
              <input type="file"  accept="image/jpg,image/jpeg,image/png" name="serial" id="xuanze" class="file" >
            </div>
            <div class="xuanze_progress fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" /><span class="xuanze_percent">80%</span></div>
            <span style="color:red;" class="fi-help-text fl lh30 mgl10">建议大小（宽610px高610px）</span> </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>是否精选：</label>
          <div class="form-controls">
            <div class="radio-group">
            <gt name="info.ischoice" value="0">
                <label><input type="radio" name="ischoice" value="1" checked>是</label>
                <label><input type="radio" name="ischoice" value="0">否</label>
            <else/>
                <label><input type="radio" name="ischoice" value="1">是</label>
                <label><input type="radio" name="ischoice" value="0" checked>否</label>
            </gt>
            </div>
          </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>是否热卖：</label>
          <div class="form-controls">
            <div class="radio-group">
            <gt name="info.ishot" value="0">
                <label><input type="radio" name="ishot" value="1" checked>是</label>
                <label><input type="radio" name="ishot" value="0">否</label>
            <else/>
                <label><input type="radio" name="ishot" value="1">是</label>
                <label><input type="radio" name="ishot" value="0" checked>否</label>
            </gt>
            </div>
          </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>是否新品：</label>
          <div class="form-controls">
            <div class="radio-group">
            <gt name="info.isnew" value="0">
                <label><input type="radio" name="isnew" value="1" checked>是</label>
                <label><input type="radio" name="isnew" value="0">否</label>
            <else/>
                <label><input type="radio" name="isnew" value="1">是</label>
                <label><input type="radio" name="isnew" value="0" checked>否</label>
            </gt>
            </div>
          </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>是否上架：</label>
          <div class="form-controls">
            <div class="radio-group">
            <gt name="info.issale" value="0">
                <label><input type="radio" name="issale" value="1" checked>是</label>
                <label><input type="radio" name="issale" value="0" >否</label>
            <else/>
                <label><input type="radio" name="issale" value="1" checked>是</label>
                <label><input type="radio" name="issale" value="0" >否</label>
            </gt>
            </div>
          </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>库存：</label>
          <div class="form-controls">
            <input type="text" class="input mini" name="stock" value="{$info.stock|default=0}">
            <span class="fi-help-text">注：输入整数字</span> </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>虚拟销量：</label>
          <div class="form-controls">
            <input type="text" class="input mini" name="virtualsales" value="{$info.virtualsales|default=0}">
            <span class="fi-help-text">注:输入整数字</span> </div>
        </div>
        <div class="formitems groupmall" style="display:none">
          <label class="fi-name"><span class="colorRed"></span>参团人数：</label>
          <div class="form-controls">
            <input type="text" class="input mini" name="grouperson" value="{$info.grouperson|default=1}">
            <span class="fi-help-text">注:输入整数字</span> </div>
        </div>
        <div class="formitems groupmall" style="display:none">
          <label class="fi-name"><span class="colorRed"></span>团结束时间：</label>
          <div class="form-controls">
            <input type="text" class="input mini" name="grouphour" value="{$info.grouphour|default=0}">
            <span class="fi-help-text">注:几小时后关闭团,0不限时间,输入整数字</span> </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>价格：</label>
          <div class="form-controls">
            <input type="text" class="input mini" name="price" value="{$info.price|default=0.00}">
            <span class="fi-help-text">注:输入数字(两位小数)</span> </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>会员价：</label>
          <div class="form-controls">
            <input type="text" class="input mini" name="vprice" value="{$info.vprice|default=0.00}">
            <span class="fi-help-text">注:输入数字(两位小数)</span> </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>原价：</label>
          <div class="form-controls">
            <input type="text" class="input mini" name="oprice" value="{$info.oprice|default=0.00}">
            <span class="fi-help-text">注:输入数字(两位小数)</span> </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>成本价：</label>
          <div class="form-controls">
            <input type="text" class="input mini" name="costprice" value="{$info.costprice|default=0.00}">
            <span class="fi-help-text">注:输入数字(两位小数)</span> </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>积分价：</label>
          <div class="form-controls">
            <input type="text" class="input mini" name="integralprice" value="{$info.integralprice|default=0.00}">
            <span class="fi-help-text">注:输入整数字</span> </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>赠送积分：</label>
          <div class="form-controls">
            <input type="text" class="input mini" name="giftpoints" value="{$info.giftpoints|default=0}">
            <span class="fi-help-text">注:输入整数字</span> </div>
        </div>
        <div class="formitems">
          <label class="fi-name"><span class="colorRed"></span>邮费：</label>
          <div class="form-controls">
            <input type="text" class="input mini" name="postage" value="{$info.postage|default=0}">
            <span class="fi-help-text">注:输入整数字</span> </div>
        </div>
        <div class="formitems"> 
          <label class="fi-name"><span class="colorRed"></span>排序：</label>
          <div class="form-controls">
            <input type="text" class="input mini" name="sorts" value="{$info.sorts|default=0}">
          </div>
        </div>
        <div class="formitems">
          <label class="fi-name">商品参数图片(多选)：</label>
          <div class="form-controls pdt5 j-imglistPanel">
            <div class="btnimage fl">选择图片
              <input type="file"  accept="image/jpg,image/jpeg,image/png" name="serial" id="duoxuan" class="file" >
            </div>
            <div class="duoxuan_progress fl mgr15" style="display:none"><img src="__IMAGES__/loadings.gif" width="30" /><span class="duoxuan_percent">80%</span></div>
            <span class="fi-help-text fl lh30 mgl10"></span>
            <div style="clear:both"></div>
            <ul class="duoxuan_showimge mgr10" id="more_pic" style="position:relative">
                <!--li style="position:relative;"> <img src="{$vo}" height="70" width="90" class="mgr10 mgt10 ">
                    <input type="hidden" name="detailpic[]" value="{$vo}">
                    <span style="position:absolute;top:-4px;right:5px;height:15px;width:15px;cursor:pointer;color:red;font-size: 1.5em;font-weight: bold;" onclick="delImg(this)">⊗</span> </li-->
                <foreach name="info.detailpic" item="vo" key="k" >
                    <img src="{$vo}" height="80"  class="mgr10 mgt10 " onclick="delImg(this)">
                    <input type="hidden" name="detailpic[]" id="pic1" value="{$vo}"></input>
                </foreach>
            </ul>
          </div>
        </div>
        <!--div class="panel-single panel-single-light mgt20 j-showinhyd" style="display: block;">
          <h3 class="cst_h3 mgb20">产品参数</h3>
          <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>产品参数：</label>
            <div class="form-controls">
              <script id="editor2" name="param" type="text/plain" style="width:200px;height:500px;"></script>
            </div>
          </div>
        </div--> 
        <!-- end 详情及其它 -->
        <div class="panel-single panel-single-light mgt20 txtCenter">
          <a href="javascript:;" onclick="javascript:history.back(-1);" class="btn btn-success">返回</a>
          <input type="submit" class="btn btn-primary" value="保存">
        </div>
      </form>
    </div>
    <!-- end content-right --> 
  </div>
</div>
<!-- end container --> 

<include file="Public:foot"/>
<div id="albums-overlay" style="display: none;"></div>
<div class="jbox fenlei select-fenlei disshow" >
  <div class="jbox-title">
    <div class="jbox-title-txt">请选择产品分类</div>
    <a href="javascript:void(0);" class="jbox-close cancle"></a></div>
  <div class="jbox-container" style="height: 75px;">
    <div class="formitems">
      <label class="fi-name"><span class="colorRed"></span>选择分类：</label>
      <div class="form-controls">
        <select name="select_class_id" id="select_class_id" class="select">
          <foreach name="catelists" item="vo" >
            <option  value="{$vo.id}">{$vo.classname}</option>
          </foreach>
        </select>
        <span class="fi-help-text"></span> </div>
    </div>
  </div>
  <div class="jbox-buttons"> <a href="javascript:void(0);" class="jbox-buttons-ok btn btn-primary" id="select_class">确定</a> <a href="javascript:void(0);" class="jbox-buttons-ok btn cancle">取消</a> </div>
</div>
<div id="albums-overlay" style="display: none;"></div>
<div id="albums-overlay1" style="display: none;"></div>
<!--时间点-->
<div class="jbox fenlei select-timelimit disshow" style="height:auto;">
  <div class="jbox-title">
    <div class="jbox-title-txt">请选择秒杀时间点</div>
    <a href="javascript:void(0);" class="jbox-close cancle1"></a></div>
  <div class="jbox-container" style="height:auto;">
    <div class="formitems">
      <label class="fi-name"><span class="colorRed"></span>请选择秒杀时间点：</label>
      <div class="form-controls">
        <select name="selecttimelimitid" class="select">
          <foreach name="timelimitlists" item="vo" >
            <option  value="{$vo.id}">{$vo.timelimit}</option>
          </foreach>
        </select>
        <span class="fi-help-text"></span> </div>
    </div>
  </div>
  <div class="jbox-buttons">
    <a href="javascript:void(0);" class="jbox-buttons-ok btn btn-primary" id="selecttimelimitid">确定</a>
    <a href="javascript:void(0);" class="jbox-buttons-ok btn cancle1">取消</a>
  </div>
</div>
<!--选择分类--> 
<script>
$('.shangcheng').each(function(){
    if($(this).is(':checked')) {
        var id = $(this).val();
        if (id == 3) {
          $('.groupmall').show();
        }else if(id == 2){
          $('.splikemall').show()
        }
    }
});
$('.shangcheng').click(function(){
    if($(this).is(':checked')) {
        var id = $(this).val();
        if (id == 3) {
          $('.groupmall').show();
        }else if(id == 2){
          $('.splikemall').show()
        }
    }else{
        var id = $(this).val();
        if (id == 3) {
          $('.groupmall').hide();
        }else if(id == 2){
          $('.splikemall').hide()
        }
    }
});
</script>
<!--选择分类--> 
<script type="text/javascript">
$("#j-select_category_id").click(function(){
  $('.select-fenlei').show();
  $('#albums-overlay').show();
})
$(".cancle").click(function(){
  $(this).parent().parent('.jbox').hide();
  $('#albums-overlay').hide();
})
$("#select_class").click(function(){
  var clssid=$("#select_class_id  option:selected").val();
  var classname=$("#select_class_id option:selected" ).text();
  $('#class_id').val(clssid);
  $('#class_name').val(classname);
  $(this).parent().parent('.jbox').hide();
  $('#albums-overlay').hide();
})
$("#j-select_series_id").click(function(){
    $('.select-series').show();
    $('#albums-overlay1').show();
})
$(".cancle1").click(function(){
    $(this).parent().parent('.jbox').hide();
    $('#albums-overlay').hide();
})
$("#select_series").click(function(){
    var seriesid=$("#select_series_id  option:selected").val();
    var seriesname=$("#select_series_id option:selected" ).text();
    $('#series_id').val(seriesid);
    $('#series_name').val(seriesname);
    $(this).parent().parent('.jbox').hide();
    $('#albums-overlay1').hide();
})
//时间点S
$("#j-selecttimelimitid").click(function(){
    var timelimitid = "{$info.timelimitid}";
    if(timelimitid){
        $('select[name=selecttimelimitid]').val(timelimitid);
    }
    $('#albums-overlay').show();
    $('.select-timelimit').show();
});
$("#selecttimelimitid").click(function(){
    var id   =$("select[name=selecttimelimitid] option:selected").val();
    var title=$("select[name=selecttimelimitid] option:selected" ).text();
    $('input[name=timelimitid]').val(id);
    $('#timelimittitle').val(title);
    $(this).parent().parent('.jbox').hide();
    $('#albums-overlay').hide();
    colseSelect($(this));
});
</script> 
<!--选择分类-end->
<!--提交表单前验证--> 
<script type="text/javascript">
 $(".start").click(function(){
    var check = $(".start").attr("checked");
    if(check==true){
        $("input[name=integral_limit]").removeAttr("disabled");
    }else{
        $("input[name=integral_limit]").attr("disabled","true");
    }
 })

function toVaild(){

    var classname=$('#class_id').val();
    var goods_name=$('#goods_name').val();
    var goods_des=$('#goods_des').val();
    var goods_ser=$('#goods_ser').val();
    var model = $('#model').val();
    var goods_title=$('#goods_title').val();
    var resource=$('#resource').val();
    var price=$('#price').val();
    var num=$('#j-totalStock').val();
    var upimg=$('#up_img1').val();
    var detail=$('#editor').text();
        var nums=$('#nums').val();
    // if(model==''||model==null){
    //     alert('产品型号必填');
    //     $('#model').focus();
    // }

//        if(goods_name==''||goods_name==null){
//            alert('产品名称必填');
//        $('#goods_name').focus();
//            return false;
//        }
    
//        if(classname==''||classname==null){
//            alert('请选择分类');
//            return false;
//        }


}
</script> 
<!--提交表单前验证end--> 

<!--上传图片--> 

<script type="text/javascript" src="__JS__/jquery.js"></script> 
<script type="text/javascript" src="__JS__/jquery-form.js"></script> 
<script>
    $("input[name=oprice]").change(function(){
        var oprice = $(this).val();//市场价
        var integral  =oprice*("{$rate}");
        integral  = Math.floor(integral*100)/100;
        $("input[name=integral]").val(integral);
        var s_integral = Math.floor(integral*("{$tage}")*100)/100;
        $("input[name=s_integral]").val(s_integral);
    })

</script> 
<script type="text/javascript">
function delImg(obj){
    if(!confirm("删除这张图片？")){
        return false;
    }
    var id = $(obj).attr("data-id")
    if(id){
        alert(1);
        return false;
    }
    $(obj).next("input").remove();
    $(obj).remove();
}
$(function () {
    var percent = $('.xuanze_percent');
    var progress = $('.xuanze_percent');
    $("#xuanze").wrap("<form id='myupload1' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
    $("#xuanze").change(function(){ //选择文件
        $("#myupload1").ajaxSubmit({
            dataType:  'json', //数据格式为json
            beforeSend: function() { //开始上传
                progress.show(); //显示进度条
                var percentVal = '0%';
                percent.html(percentVal);
            },
            uploadProgress: function(event, position, total, percentComplete) {
                var percentVal = percentComplete + '%'; //获得进度
                percent.html(percentVal); //显示上传进度百分比
            },
            success: function(data) { //成功
                var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="80" ><input type="hidden" name="logo" id="pic" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
                $('.xuanze_showimge').html(img);
                progress.hide();
            },
            error:function(xhr){ //上传失败
                //console.log(xhr.status)
            }
        });
    });
    
    var percent = $('.duoxuan_percent');
    var progress = $('.duoxuan_percent');
    $("#duoxuan").wrap("<form id='myupload' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
    $("#duoxuan").change(function(){ //选择文件
        $("#myupload").ajaxSubmit({
            dataType:  'json', //数据格式为json
            beforeSend: function() { //开始上传
                progress.show(); //显示进度条
                var percentVal = '0%';
                percent.html(percentVal);
            },
            uploadProgress: function(event, position, total, percentComplete) {
                var percentVal = percentComplete + '%'; //获得进度
                percent.html(percentVal); //显示上传进度百分比
            },
            success: function(data) { //成功
                var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="80"  class="mgr10 mgt10 " onclick="delImg(this)"><input type="hidden" name="detailpic[]" id="pic1" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
                console.log(img);
                $('.duoxuan_showimge').append(img);
                progress.hide();
            },
            error:function(xhr){ //上传失败
                //console.log(xhr.status)
            }
        });
    });

    var percent = $('.baotuan_percent');
    var progress = $('.baotuan_percent');
    $("#baotuan").wrap("<form id='baotuan1' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
    $("#baotuan").change(function(){ //选择文件
      $("#baotuan1").ajaxSubmit({
        dataType:  'json', //数据格式为json
        beforeSend: function() { //开始上传
          progress.show(); //显示进度条
          var percentVal = '0%';
          percent.html(percentVal);
        },
        uploadProgress: function(event, position, total, percentComplete) {
          var percentVal = percentComplete + '%'; //获得进度
          percent.html(percentVal); //显示上传进度百分比
        },
        success: function(data) { //成功
          var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'" height="80" ><input type="hidden" name="index_pic" id="pic2" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"></input>';
          $('.baotuan_showimge').html(img);
          progress.hide();
        },
        error:function(xhr){ //上传失败
          //console.log(xhr.status)
        }
      });
    });
});
function add_re(r){
    $('#restriction'+r).show();
}
function del_re(r){
    $('#restriction'+r).hide();
}
</script> 
<!--上传图片-end->










