<include file="Public:head"/>
<script type="text/javascript" src="__JS__/jquery.js"></script>
<style>
.imgnav{
    max-height: 30px;
    overflow: hidden;
    cursor: pointer;
}
.imgwrapper{
    display: block;
    width: 78px;
    height: 78px;
    overflow: hidden;
}
.imgwrapper img{
    display: block;
    width: 100%;
    padding: 0;
    margin: 0;
    border:0;
}
.spanpd10{
    margin:10px;
}
.wxtables.wxtables-sku.newtable{
    width: 40%;
    margin: 0;
}
.img-list li{
    width: 60px;
    height:60px;
}
.cst_h3 span{font-weight: normal;}
#imgdiv img{ max-width:190px; max-height:190px; display:none; margin:5px;}
.btnimage{width:80px; height:30px; background:white; border:1px solid #d9d9d9;cursor:pointer; position:relative; text-align:center; line-height:31px;}
.file{ position:absolute; top:0px; left:0; width:80px; height:30px; background:white; border:1px solid #d9d9d9;cursor:pointer; opacity:0}
#imgdiv2 img{ max-width:88px; max-height:88px; display:none; margin:5px;}
#xuanze2{ width:60px; height:30px; background:white; border:1px solid #d9d9d9; }
#xuanze2:hover{ background:#E6E6E6; }
.huase{display:none; width:86px; height:30px; margin:5px; text-indent:5px;}
.formitems .fi-name{width:300px !important;}
</style>
<script type="text/javascript" src="__LHG__/lhgcore.min.js"></script>
<script type="text/javascript" src="__LHG__/lhgcalendar.min.js"></script>
<script type="text/javascript" src="__JS__/datepicker/WdatePicker.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=A607d61b18d43a1ff27abf4ac67da83c"></script>

<div class="container">
<div class="inner clearfix">
        <include file="Public:left" />
<!-- end content-left -->

<div class="content-right fl">
<h1 class="content-right-title">查看详情</h1>
<form aciton="{:U('/Admin/Member/detail')}" method="post" id="setInformation">
<div class="panel-single panel-single-light mgt20">
        <h3 class="cst_h3 mgb20">基本信息</h3>
    <div>
        <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>部门：</label>
            <div class="form-controls">
                <select name='branchid' style='padding:5px;border: 1px solid #ccc;width:182px' id='branchid'>
                    <!--option value="0">--请选择部门--</option-->
                    <foreach name="branchlists" item="vo" >
                        <option value="{$vo.id}" <if condition="$info['branchid'] eq $vo['id']">selected</if>>{$vo.classtitle}</option>
                    </foreach>
                </select>
                <span class="fi-help-text"></span> </div>
        </div>
        <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>职位：</label>
            <div class="form-controls">
                <select name='gid' style='padding:5px;border: 1px solid #ccc;width:182px' id='gid'>
                    <!--option value="0">--请选择职位--</option-->
                    <foreach name="joblists" item="vo" >
                        <option value="{$vo.id}" <if condition="$info['gid'] eq $vo['id']">selected</if>>{$vo.classtitle}</option>
                    </foreach>
                </select>
                <span class="fi-help-text"></span> </div>
        </div>
        <div class="formitems">
            <label class="fi-name">头像：</label>
            <div class="form-controls pdt5 j-imglistPanel">
                <div class="pic1_showimage fl mgr10">
                    <img src="{$info.person_img}" width="60px">
                </div>
                <div class="btnimage fl">选择图片
                    <input type="file"  accept="image/jpg,image/jpeg,image/png" name="pic1" id="pic1" class="file" >
                </div>
                <div class="pic1_progress fl mgr15" style="display:none">
                    <img src="__IMAGES__/loadings.gif" width="30" />
                    <span class="pic1_percent">80%</span>
                </div>
                <span class="fi-help-text fl lh30 mgl10">建议大小（宽60高36）</span>
            </div>
        </div>
        <div class="formitems">
            <label class="fi-name"><span class="colorRed">*</span>真实名字：</label>
            <div class="form-controls">
                <input type="text" class="input" value="{$info.realname}" id='realname' name="realname" >
                <span class="lh30 mgl10"></span>
            </div>
        </div>
        <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>昵称：</label>
            <div class="form-controls">
                <input type="text" class="input" value="{$info.person_name}" id="person_name" name="person_name">
                <span class="lh30 mgl10"></span>
            </div>
        </div>
        <div class="formitems">
            <label class="fi-name">手机号：</label>
            <div class="form-controls">
                {$info.telephone}
            </div>
        </div>
        <div class="formitems">
            <label class="fi-name">修改密码：</label>
            <div class="form-controls">
                <input type="password" class="input" placeholder='不填写则不修改,密码6~16位'  name="password"  id='password'>
                <span class="lh30 mgl10">不填写则不修改,密码6~16位</span>
            </div>
        </div>
        <div class="formitems">
            <label class="fi-name">性别：</label>
            <div class="form-controls">
                <if condition="$info['sex'] eq 1">
                <input type="radio" name='sex' value='1' checked/>男
                <input type="radio" name='sex' value='2'/>女
                <else/>
                <input type="radio" name='sex' value='1'/>男
                <input type="radio" name='sex' value='2' checked="" />女
                </if>
                <span class="fi-help-text"></span>
            </div>
        </div>
        <div class="formitems">
            <label class="fi-name"> 生日：</label>
            <div class="form-controls">
                <input type="text" class="input" readonly onClick="WdatePicker({dateFmt:'yyyy-MM-dd'})"
                       name="birth" id="birth" value="{$info.birth}">
            </div>
        </div>
        <div class="formitems">
            <label class="fi-name">身份证号：</label>
            <div class="form-controls">{$info.idcard}</div>
        </div>
        <!--div class="formitems">
            <label class="fi-name">详细地址：</label>
            <div class="form-controls">{$info.province}{$info.city}{$info.district}{$info.address}</div>
        </div-->
        <div class="formitems">
            <label class="fi-name">QQ：</label>
            <div class="form-controls">
            <empty name="info.qq" value="">
                <input type="text" class="input" id="qq" name="qq">
            <else/>
                {$info.qq}
            </empty>
            </div>
        </div>
        <div class="formitems">
            <label class="fi-name">邮箱：</label>
            <div class="form-controls">
            <empty name="info.email" value="">
                <input type="email" class="input" id="email" name="email">
            <else/>
                {$info.email}
            </empty>
            </div>
        </div>
        <div class="formitems">
            <label class="fi-name"><span class="colorRed"></span>个人主页：</label>
            <div class="form-controls">
                <input type="text" class="input" value="{$info.website}" id='website' name="website" >
            </div>
        </div>
        <div class="formitems">
            <label class="fi-name">个性签名：</label>
            <div class="form-controls" style="padding-top:5px">
                <textarea name="signature" cols="40" rows="3" placeholder="建议30-50个字" id="signature" style="line-height:16px;text-align: left;">{$info.signature|htmlspecialchars_decode|stripslashes}</textarea>
            </div>
        </div>
         
        
        
        
        
        
        
         <div class="formitems">
            <label class="fi-name">注册时间：</label>
            <div class="form-controls">{$info.add_time}</div>
        </div>
         <div class="formitems">
            <label class="fi-name">最后登录时间：</label>
            <div class="form-controls">{$info.last_login_time}</div>
        </div>
        <input type="hidden" name='id' value="{$info.id}">
    </div>
</div>
<!-- end 基本信息 -->
<!-- end 详情及其它 -->
<div class="panel-single panel-single-light mgt20 txtCenter">
    <a href="javascript:history.back(-1)" class="btn">返回</a>
    <input type="button" id="submit" class="btn btn-primary" value="保存">
</div>
</form>

</div>
<!-- end content-right -->
</div>
</div>
<!-- end container -->
<include file="Public:foot"/>
<script type="text/javascript" src="__JS__/jquery-form.js"></script>
<script>
$(function () {
    var percent = $('.pic1_percent');
    var progress = $('.pic1_progress');
    $("#pic1").wrap("<form id='pic11' action='{:U('/Admin/Index/addImage')}' method='post' enctype='multipart/form-data'></form>");
    $("#pic1").change(function(){ //选择文件
        $("#pic11").ajaxSubmit({
            dataType:  'json', //数据格式为json
            beforeSend: function() { //开始上传
                progress.show(); //显示进度条
                var percentVal = '0%';
                percent.html(percentVal);
            },
            uploadProgress: function(event, position, total, percentComplete) {
                var percentVal = percentComplete + '%'; //获得进度
                percent.html(percentVal); //显示上传进度百分比
            },
            success: function(data) { //成功
                //console.log(data);
                var img = '<img src="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'"  width="100px" class="mgr10 mgt10 " onclick="delImg(this)"><input type="hidden" name="person_img" id="logo" value="'+data[0]["savepath"].substr(1)+data[0]["savename"]+'">';
                //console.log(img);
                progress.hide();
                $('.pic1_showimage').html(img);
            },
            error:function(xhr){ //上传失败
                //console.log(xhr.status)
            }
        });
    });
});
$('#submit').click(function(){
    /*
    var branchid =$("select[name=branchid]").val();
    var gid      =$("select[name=gid]").val();
    var realname =$.trim($("input[name=realname]").val());
    var person_name =$.trim($("input[name=person_name]").val());
    var password =$.trim($("input[name=password]").val());
    var sex      =$("input[name=sex]:checked").val();
    var birth =$.trim($("input[name=birth]").val());
    var qq =$.trim($("input[name=qq]").val());
    var email =$.trim($("input[name=email]").val());
    var website =$.trim($("input[name=website]").val());
    var email =$.trim($("input[name=email]").val());

    var form = new FormData();
    form.append("person_name",$('#person_name').val());
    form.append("company",$('#company').val());
    form.append("realname",$('#realname').val());
    form.append("sex",$('input:radio[name=sex]:checked').val());
    form.append("password",$('#password').val());
    form.append("memberdetail",$('#member-id').val());
    form.append("telephone",$('#telephone').val());
    form.append("birth",$('#birth').val());
    form.append("email",$('#email').val());*/
    var realname =$.trim($("input[name=realname]").val());
    if(realname.length<1)
    {
        dialog.showTips('真实姓名必填','warn');$("input[name=realname]").focus();return false;
    }else if(realname.length>30){
        dialog.showTips('真实姓名必须30字内','warn');$("input[name=realname]").focus();return false;
    }
    var person_name =$.trim($("input[name=person_name]").val());
    if(person_name.length>0){
        if(person_name.length>30){
            dialog.showTips('昵称必须30字内','warn');$("input[name=person_name]").focus();return false;
        }
    }
    var password =$.trim($("input[name=password]").val());
    if(password.length > 0){
        if(!password.match(/^[a-zA-Z0-9]{6,16}$/)){
            dialog.showTips('密码格式错误','warn');$("input[name=password]").focus();return false;
        }
    }
    var email =$.trim($("input[name=email]").val());
    if(email.length > 0){
        if(!email.match(/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/)){
            dialog.showTips('邮箱格式错误','warn');$("input[name=email]").focus();return false;
        }
    }
    var data = $("#setInformation").serialize();
    $.post("{:U('/Admin/Member/detail')}",data,function(g){
        if(g.status == 1){
            dialog.showTips(g.info,'',"{:U('/Admin/Member/index')}");return false;
        }else{
           dialog.showTips(g.info,'warn');return false;
        }
    },"json");
})
</script>



